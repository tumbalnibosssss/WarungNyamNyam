<!DOCTYPE html>
<html>
<head>
  <title>Menu - Warung Nyam Nyam</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #f7f7f7;
    }

    header {
      background: #e63946;
      color: white;
      padding: 16px;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .container {
      padding: 16px;
      max-width: 1100px;
      margin: auto;
    }

    .category {
      margin-bottom: 32px;
    }

    .category h2 {
      margin: 8px 0 16px;
      font-size: 20px;
      border-left: 5px solid #e63946;
      padding-left: 10px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 16px;
    }

    .card {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
    }

    .card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      background: #eee;
    }

    .card-body {
      padding: 12px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .name {
      font-weight: 600;
      margin-bottom: 6px;
    }

    .price {
      color: #e63946;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .btn {
      border: none;
      background: #e63946;
      color: white;
      padding: 10px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
    }

    .cart {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid #eee;
      padding: 12px;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
    }

    .cart p {
      margin: 4px 0;
      font-size: 14px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<header>üçΩ Menu Warung Nyam Nyam</header>

<div class="container" id="menu-container"></div>

<div id="cart" class="cart hidden">
  <div id="cart-items"></div>
  <button class="btn" onclick="checkout()">Pesan via WhatsApp</button>
</div>

<script>
const WA_NUMBER = "6281261040365"

let menus = []
let cart = {}

async function loadMenus() {
  const res = await fetch('/api/menus')
  menus = await res.json()
  renderMenus()
}

function renderMenus() {
  const container = document.getElementById('menu-container')

  // Group menu berdasarkan kategori
  const grouped = {}
  menus.forEach(m => {
    const cat = m.category || 'Lainnya'
    if (!grouped[cat]) grouped[cat] = []
    grouped[cat].push(m)
  })

  container.innerHTML = Object.keys(grouped).map(cat => `
    <div class="category">
      <h2>${cat}</h2>

      <div class="grid">
        ${grouped[cat].map(m => `
          <div class="card">
            <img 
              src="${m.image_url || '/images/no-image.png'}"
              onerror="this.src='/images/no-image.png'"
              alt="${m.name}"
            >

            <div class="card-body">
              <div class="name">${m.name}</div>
              <div class="price">Rp ${Number(m.price).toLocaleString('id-ID')}</div>

              <button class="btn" onclick="addToCart('${m.id}')">
                Tambah ke Keranjang
              </button>
            </div>
          </div>
        `).join('')}
      </div>
    </div>
  `).join('')
}

function addToCart(id) {
  cart[id] = (cart[id] || 0) + 1
  renderCart()
}

function renderCart() {
  const cartEl = document.getElementById('cart')
  const itemsEl = document.getElementById('cart-items')

  const items = Object.entries(cart)
  if (items.length === 0) {
    cartEl.classList.add('hidden')
    return
  }

  cartEl.classList.remove('hidden')

  itemsEl.innerHTML = items.map(([id, qty]) => {
    const menu = menus.find(m => m.id === id)
    return `<p>‚Ä¢ ${menu.name} = ${qty}</p>`
  }).join('')
}

function checkout() {
  let text = 'Bang aku pesan:%0A'
  Object.entries(cart).forEach(([id, qty], i) => {
    const m = menus.find(x => x.id === id)
    text += `${i+1}. ${m.name} = ${qty}%0A`
  })

  window.open(`https://wa.me/${WA_NUMBER}?text=${text}`, '_blank')
}

loadMenus()
</script>

</body>
</html>
